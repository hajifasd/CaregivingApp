<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¤è¯å®ˆå«æµ‹è¯•é¡µé¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">è®¤è¯å®ˆå«ä¿®å¤æµ‹è¯•</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- ç”¨æˆ·ç«¯æµ‹è¯• -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4 text-blue-600">ç”¨æˆ·ç«¯æµ‹è¯•</h2>
                <div class="space-y-2">
                    <div>è®¤è¯å®ˆå«: <span class="font-mono text-sm">user-auth-guard.js</span></div>
                    <div>Tokenæ£€æŸ¥: <span id="user-token-status" class="text-sm">æ£€æŸ¥ä¸­...</span></div>
                    <div>è®¤è¯çŠ¶æ€: <span id="user-auth-status" class="text-sm">æ£€æŸ¥ä¸­...</span></div>
                </div>
                <div class="mt-4">
                    <button onclick="testUserAuth()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        æµ‹è¯•ç”¨æˆ·è®¤è¯
                    </button>
                </div>
            </div>
            
            <!-- æŠ¤å·¥ç«¯æµ‹è¯• -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4 text-green-600">æŠ¤å·¥ç«¯æµ‹è¯•</h2>
                <div class="space-y-2">
                    <div>è®¤è¯å®ˆå«: <span class="font-mono text-sm">caregiver-auth-guard.js</span></div>
                    <div>Tokenæ£€æŸ¥: <span id="caregiver-token-status" class="text-sm">æ£€æŸ¥ä¸­...</span></div>
                    <div>è®¤è¯çŠ¶æ€: <span id="caregiver-auth-status" class="text-sm">æ£€æŸ¥ä¸­...</span></div>
                </div>
                <div class="mt-4">
                    <button onclick="testCaregiverAuth()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                        æµ‹è¯•æŠ¤å·¥è®¤è¯
                    </button>
                </div>
            </div>
            
            <!-- ç®¡ç†ç«¯æµ‹è¯• -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4 text-purple-600">ç®¡ç†ç«¯æµ‹è¯•</h2>
                <div class="space-y-2">
                    <div>è®¤è¯å®ˆå«: <span class="font-mono text-sm">admin-auth-guard.js</span></div>
                    <div>Tokenæ£€æŸ¥: <span id="admin-token-status" class="text-sm">æ£€æŸ¥ä¸­...</span></div>
                    <div>è®¤è¯çŠ¶æ€: <span id="admin-auth-status" class="text-sm">æ£€æŸ¥ä¸­...</span></div>
                </div>
                <div class="mt-4">
                    <button onclick="testAdminAuth()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                        æµ‹è¯•ç®¡ç†è®¤è¯
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æµ‹è¯•ç»“æœ -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">æµ‹è¯•ç»“æœ</h2>
            <div id="test-results" class="space-y-2">
                <div class="text-gray-500">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <div class="mt-8 text-center space-x-4">
            <button onclick="clearAllTokens()" class="bg-red-500 text-white px-6 py-2 rounded hover:bg-red-600">
                æ¸…é™¤æ‰€æœ‰Token
            </button>
            <button onclick="setTestTokens()" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                è®¾ç½®æµ‹è¯•Token
            </button>
            <button onclick="runAllTests()" class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">
                è¿è¡Œæ‰€æœ‰æµ‹è¯•
            </button>
        </div>
    </div>

    <script>
        // æµ‹è¯•ç»“æœå®¹å™¨
        const testResults = document.getElementById('test-results');
        
        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(message, type = 'info') {
            const div = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = {
                'success': 'text-green-600',
                'error': 'text-red-600',
                'warning': 'text-yellow-600',
                'info': 'text-blue-600'
            }[type] || 'text-gray-600';
            
            div.innerHTML = `<span class="text-gray-400">[${timestamp}]</span> <span class="${colorClass}">${message}</span>`;
            testResults.appendChild(div);
            testResults.scrollTop = testResults.scrollHeight;
        }
        
        // æ£€æŸ¥TokençŠ¶æ€
        function checkTokenStatus() {
            const userToken = localStorage.getItem('user_token');
            const caregiverToken = localStorage.getItem('caregiver_token');
            const adminToken = localStorage.getItem('admin_token');
            
            document.getElementById('user-token-status').textContent = userToken ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®';
            document.getElementById('caregiver-token-status').textContent = caregiverToken ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®';
            document.getElementById('admin-token-status').textContent = adminToken ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®';
            
            return { userToken, caregiverToken, adminToken };
        }
        
        // æµ‹è¯•ç”¨æˆ·è®¤è¯
        function testUserAuth() {
            addTestResult('å¼€å§‹æµ‹è¯•ç”¨æˆ·è®¤è¯...', 'info');
            
            const { userToken } = checkTokenStatus();
            
            if (!userToken) {
                addTestResult('âŒ ç”¨æˆ·Tokenæœªè®¾ç½®', 'error');
                document.getElementById('user-auth-status').textContent = 'æœªè®¤è¯';
                return;
            }
            
            try {
                // æ¨¡æ‹Ÿè®¤è¯æ£€æŸ¥
                const payload = JSON.parse(atob(userToken.split('.')[1].replace(/-/g, '+').replace(/_/g, '/')));
                
                if (payload.user_type === 'user') {
                    addTestResult('âœ… ç”¨æˆ·è®¤è¯æ£€æŸ¥é€šè¿‡', 'success');
                    document.getElementById('user-auth-status').textContent = 'å·²è®¤è¯';
                } else {
                    addTestResult('âŒ ç”¨æˆ·ç±»å‹ä¸åŒ¹é…', 'error');
                    document.getElementById('user-auth-status').textContent = 'è®¤è¯å¤±è´¥';
                }
            } catch (error) {
                addTestResult('âŒ Tokenè§£æå¤±è´¥: ' + error.message, 'error');
                document.getElementById('user-auth-status').textContent = 'Tokenæ— æ•ˆ';
            }
        }
        
        // æµ‹è¯•æŠ¤å·¥è®¤è¯
        function testCaregiverAuth() {
            addTestResult('å¼€å§‹æµ‹è¯•æŠ¤å·¥è®¤è¯...', 'info');
            
            const { caregiverToken } = checkTokenStatus();
            
            if (!caregiverToken) {
                addTestResult('âŒ æŠ¤å·¥Tokenæœªè®¾ç½®', 'error');
                document.getElementById('caregiver-auth-status').textContent = 'æœªè®¤è¯';
                return;
            }
            
            try {
                const payload = JSON.parse(atob(caregiverToken.split('.')[1].replace(/-/g, '+').replace(/_/g, '/')));
                
                if (payload.user_type === 'caregiver') {
                    addTestResult('âœ… æŠ¤å·¥è®¤è¯æ£€æŸ¥é€šè¿‡', 'success');
                    document.getElementById('caregiver-auth-status').textContent = 'å·²è®¤è¯';
                } else {
                    addTestResult('âŒ ç”¨æˆ·ç±»å‹ä¸åŒ¹é…', 'error');
                    document.getElementById('caregiver-auth-status').textContent = 'è®¤è¯å¤±è´¥';
                }
            } catch (error) {
                addTestResult('âŒ Tokenè§£æå¤±è´¥: ' + error.message, 'error');
                document.getElementById('caregiver-auth-status').textContent = 'Tokenæ— æ•ˆ';
            }
        }
        
        // æµ‹è¯•ç®¡ç†è®¤è¯
        function testAdminAuth() {
            addTestResult('å¼€å§‹æµ‹è¯•ç®¡ç†è®¤è¯...', 'info');
            
            const { adminToken } = checkTokenStatus();
            
            if (!adminToken) {
                addTestResult('âŒ ç®¡ç†Tokenæœªè®¾ç½®', 'error');
                document.getElementById('admin-auth-status').textContent = 'æœªè®¤è¯';
                return;
            }
            
            try {
                const payload = JSON.parse(atob(adminToken.split('.')[1].replace(/-/g, '+').replace(/_/g, '/')));
                
                if (payload.user_type === 'admin') {
                    addTestResult('âœ… ç®¡ç†è®¤è¯æ£€æŸ¥é€šè¿‡', 'success');
                    document.getElementById('admin-auth-status').textContent = 'å·²è®¤è¯';
                } else {
                    addTestResult('âŒ ç”¨æˆ·ç±»å‹ä¸åŒ¹é…', 'error');
                    document.getElementById('admin-auth-status').textContent = 'è®¤è¯å¤±è´¥';
                }
            } catch (error) {
                addTestResult('âŒ Tokenè§£æå¤±è´¥: ' + error.message, 'error');
                document.getElementById('admin-auth-status').textContent = 'Tokenæ— æ•ˆ';
            }
        }
        
        // æ¸…é™¤æ‰€æœ‰Token
        function clearAllTokens() {
            localStorage.removeItem('user_token');
            localStorage.removeItem('caregiver_token');
            localStorage.removeItem('admin_token');
            localStorage.removeItem('user_info');
            localStorage.removeItem('caregiver_info');
            localStorage.removeItem('admin_info');
            
            checkTokenStatus();
            addTestResult('ğŸ—‘ï¸ å·²æ¸…é™¤æ‰€æœ‰Token', 'warning');
        }
        
        // è®¾ç½®æµ‹è¯•Token
        function setTestTokens() {
            // åˆ›å»ºæµ‹è¯•Tokenï¼ˆä»…ç”¨äºæµ‹è¯•ï¼Œå®é™…åº”ç”¨ä¸­åº”è¯¥ä»æœåŠ¡å™¨è·å–ï¼‰
            const testUserToken = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VyX3R5cGUiOiJ1c2VyIiwiaWF0IjoxNzAzNDQ4MDAwLCJleHAiOjE3MDM1MzQ0MDB9.test';
            const testCaregiverToken = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VyX3R5cGUiOiJjYXJlZ2l2ZXIiLCJpYXQiOjE3MDM0NDgwMDAsImV4cCI6MTcwMzUzNDQwMH0.test';
            const testAdminToken = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjowLCJ1c2VyX3R5cGUiOiJhZG1pbiIsImlhdCI6MTcwMzQ0ODAwMCwiZXhwIjoxNzAzNTM0NDAwfQ.test';
            
            localStorage.setItem('user_token', testUserToken);
            localStorage.setItem('caregiver_token', testCaregiverToken);
            localStorage.setItem('admin_token', testAdminToken);
            
            checkTokenStatus();
            addTestResult('ğŸ”§ å·²è®¾ç½®æµ‹è¯•Token', 'info');
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            addTestResult('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰è®¤è¯æµ‹è¯•...', 'info');
            testUserAuth();
            setTimeout(() => testCaregiverAuth(), 500);
            setTimeout(() => testAdminAuth(), 1000);
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥TokençŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            checkTokenStatus();
            addTestResult('ğŸ“‹ è®¤è¯å®ˆå«ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½', 'info');
        });
    </script>
</body>
</html>
